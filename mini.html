<!DOCTYPE html><head><title>Raycaster</title><style>#g {background: black;display: block;margin: auto;}</style></head><body><canvas id="g" width="1200" height="900"></canvas></body></html><script>var l={};window.onkeyup=function(t){l[t.keyCode]=false};window.onkeydown=function(t){l[t.keyCode]=true};const f=1200,h=900,k=Math.floor;let m,C,D,I;function L(l){let t=Array(l).fill(1);m=Array.from({length:l},(t,a)=>Array.from({length:l},(t,e)=>a===0||e===0||a===l-1||e===l-1?1:Math.random()<.8?0:Math.floor(Math.random()*3)+2));C=l;D=Math.floor(Math.random()*(l-2))+1;I=Math.floor(Math.random()*(l-2))+1;m[D][I]=5}L(10);let O=8,j=8,p=-1,q=0,x=0,z=.66;var t=document.getElementById("g");if(t.getContext){var M=t.getContext("2d")}const B=t=>["#888","#fff","#080","#0f0","#008","#00f","#800","#f00","#808","#f0f"][t-1]||"#fff";function E(t,e,a="black",l=1){if(a){M.strokeStyle=a}if(l){M.lineWidth=l}M.beginPath();M.moveTo(...t);M.lineTo(...e);M.stroke()}function i(){M.fillStyle="black";M.fillRect(40,40,C*4,C*4);for(let a=0;a<C;a++){for(let e=0;e<C;e++){if(m[a][e]>0){let t=B(m[a][e]*2);M.fillStyle=t;M.fillRect(40+a*4,40+e*4,4,4)}}}M.fillStyle="yellow";M.beginPath();M.arc(40+O*4,40+j*4,3,0,2*Math.PI);M.fill()}function n(t){M.clearRect(0,0,f,h);let A=f,b=h;for(let g=0;g<A;g++){let t=2*g/A-1;let e=p+x*t;let a=q+z*t;let l=k(O);let f=k(j);let h,M;let i=e==0?1e30:Math.abs(1/e);let n=a==0?1e30:Math.abs(1/a);let o,c,r,u;let s=0;if(e<0){c=-1;h=(O-l)*i}else{c=1;h=(l+1-O)*i}if(a<0){r=-1;M=(j-f)*n}else{r=1;M=(f+1-j)*n}while(s==0){if(h<M){h+=i;l+=c;u=0}else{M+=n;f+=r;u=1}if(m[l][f]>0)s=1}if(u==0)o=(l-O+(1-c)/2)/e;else o=(f-j+(1-r)/2)/a;let d=Math.abs(k(b/o));let w=Math.max(k(-d/2+b/2),0);let v=Math.min(k(d/2+b/2),b-1);let y=B(m[l][f]*2);if(u==1)y=B(m[l][f]*2-1);E([g,w],[g,v],y,1);if(Math.abs(D-O)<1.5&&Math.abs(I-j)<1.5){L(C+10);O=8;j=8}}let e=5*t;let a=3*t;if(l["87"]){if(m[k(O+p*e)][k(j)]==0)O+=p*e;if(m[k(O)][k(j+q*e)]==0)j+=q*e}if(l["83"]){if(m[k(O-p*e)][k(j)]==0)O-=p*e;if(m[k(O)][k(j-q*e)]==0)j-=q*e}if(l["68"]){let t=p;p=p*Math.cos(-a)-q*Math.sin(-a);q=t*Math.sin(-a)+q*Math.cos(-a);let e=x;x=x*Math.cos(-a)-z*Math.sin(-a);z=e*Math.sin(-a)+z*Math.cos(-a)}if(l["65"]){let t=p;p=p*Math.cos(a)-q*Math.sin(a);q=t*Math.sin(a)+q*Math.cos(a);let e=x;x=x*Math.cos(a)-z*Math.sin(a);z=e*Math.sin(a)+z*Math.cos(a)}i()}document.addEventListener("DOMContentLoaded",function(t){let e=30;let a=1/e;setInterval(function(){n(a)},a*1e3)});</script>